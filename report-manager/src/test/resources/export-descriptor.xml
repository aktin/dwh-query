<?xml version="1.0" encoding="UTF-8"?>
<export xmlns="http://sekmi.de/ns/histream/export-v1">
	<concepts>
		<group class="transportmittel">
			<!-- define class name to group multiple concepts
			     of which only one can occur in this case -->
			<concept wildcard-notation="AKTIN:TRANSFER:*" />
		</group>
		<group class="d_lab">
			<concept notation="LOINC:37637-6" />
			<concept notation="LOINC:37637-6:NEG" />
		</group>
		<group class="diag">
			<!-- wildcard-notation only supported until ontology IRI queries are -->
			<concept wildcard-notation="ICD10GM:*" />
		</group>
		<concept notation="XYZ" />
	</concepts>


	<patient-table>
		<column header="patient_id" xpath="@id"/>
		<column header="geburtsdatum_ts" xpath="eav:birthdate"/>
		<column header="geschlecht" xpath="eav:gender"/>
	</patient-table>
	<visit-table>
		<!-- context for XPath expressions is each visit node -->
		<!-- XMLNS for XPath is assumed to be  http://sekmi.de/histream/ns/eav-data -->
		<column header="patient_id" xpath="../@id"/>
		<column header="visit_id" xpath="@id"/>
		<column header="transportmittel" xpath="substring(eav:fact[@class='transportmittel']/@concept, 16)"/>
		<column header="postleitzahl" xpath="eav:fact[@concept='AKTIN:ZIPCODE']/eav:value"/>
		<!-- concepts for the visit table must occur only once
		per visit and may not repeat -->
		<column header="start" xpath="eav:start"/>
		<!-- What is better? -->
		<!-- (a) First column, then concepts with value -->
		<column header="diagnostik_labor_ts" xpath="eav:fact[@class='d_lab']/@start"/>
		<column header="diagnostik_labor" xpath="eav:fact[@class='d_lab']/@concept"/>
		<!-- (b) first concepts then columns with value -->
		<column header="diagnostik_labort_ts" xpath="eav:fact[@class='d_lab']/@start"/>
		<column header="diagnostik_labort" xpath="eav:fact[@class='d_lab']/eav:modifier[@code='OPB' or @code='PB']/@code"/>
			<!-- We want this: 
					6:NEG -> not tested
					6/mod=OPB -> tested non pathological
					6/mod=PB -> tested pathological 
			-->
	</visit-table>
	<!-- export separate table for repeating elements -->
	<eav-table id="diagnose" class="diag">
		<!-- context for XPath expressions is each fact node -->
		<column header="patient_id" xpath="patient-ref"/>
		<column header="visit_id" xpath="visit-ref"/>
		<column header="start" type="@start"/>
		<column header="code" type="@concept"/>
		<column header="fuehrend" xpath="eav:modifier[@code='fuehrend']/@code"/>
		<column header="txt" xpath="eav:modifier[@code='originalText']/@value"/>
	</eav-table>
</export>