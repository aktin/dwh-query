<?xml version="1.0" encoding="UTF-8"?>
<datasource version="1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
	<meta>
		<id>test-1</id>
		<etl-strategy>replace-source</etl-strategy>
	</meta>
	
	<patient-table>
		<source xsi:type="csv-file">
			<url>patients.txt</url>
			<separator>\t</separator>
		</source>
		<idat>
			<patient-id column="patient_id"/>
			<given-name  column="patient_id"/>
			<surname column="patient_id"/>
			<birthdate format="u-M-d" na="" column="geburtsdatum_ts"/>
			<gender column="geschlecht" na="">
				<map> <!-- maps a column -->
					<case value="F" set-value="female"/>
					<case value="M" set-value="male"/>	
					<case value="UN" set-value="indeterminate"/>					
					<otherwise set-value="" log-warning="Unexpected gender value"/>
				</map>
			</gender>
			<ignore xsi:type="string" column="XXX"/>
			<!--
			<ignore xsi:type="string" column="ignoriert1"/>
			<ignore xsi:type="string" column="patfakt1"/> -->
		</idat>
		<!-- for MDAT in patient table, use the same patient-table also as
		a visit table (visit date needed). the patient id can be re-used
		as visit id, or a constant visit ID can be used. -->
	</patient-table>
	<!-- optional -->
	<visit-table>
		<source xsi:type="csv-file">
			<url>encounters.txt</url>
			<type>text/csv</type>
			<separator>\t</separator>
		</source>
		<idat>
			<patient-id column="patient_id"/>
			<visit-id column="encounter_id"/>
			<start column="aufnahme_ts" format="u-M-d H:m" na=""/>
			<end column="entlassung_ts" format="u-M-d H:m" na=""/>
			
			<ignore xsi:type="string" column="XXX"/>
			<ignore xsi:type="string" column="diagnose_fuehrend"/> 
		</idat>
		<mdat> <!-- in order of data file (Wolfsburg) -->
			<concept id="isolation">
                <value column="isolation" na="" xsi:type="string">
					<map>
						<case value="AKTIN:ISOLATION:ISO" set-value="" set-concept="AKTIN:ISOLATION:ISO"/>
						<otherwise action="drop-fact" />
					</map>
				</value>
			</concept>
			<concept id="isolationreason">
                <value column="isolationreason" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="zuweisung">
                <value column="zuweisung" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="triage">
                <start column="triage_ts" format="u-M-d[ H[:m[:s]]]" na=""/>
                <value column="triage" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="AKTIN:PHYSENCOUNTER">
                <start column="arztkontakt_ts" format="u-M-d[ H[:m[:s]]]" na=""/>
		<value na="" constant-value="" xsi:type="string"/>
			</concept>
            <concept id="AKTIN:STARTTHERAPY">
                <start column="therapiebeginn_ts" format="u-M-d[ H[:m[:s]]]" na=""/>
		<value na="" constant-value="" xsi:type="string"/>
			</concept>
            <concept id="cedis">
                <value column="cedis" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="keime">
                <value column="keime" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="behandlungsende"> <!-- gibt es eigentlich nicht, warum ist das Ã¼berhaupt in der Tabelle :) -->
                <value column="behandlungsende" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="entlassung">
                <start column="entlassung_ts" format="u-M-d[ H[:m[:s]]]" na=""/>
                <value column="entlassung" na="" xsi:type="string">
                </value>
			</concept>
            <concept id="transportmittel">
                <value column="transportmittel" na="" xsi:type="string">
                </value>
			</concept>
            <!--<<concept id="diagnose_fuehrend">
                <value column="diagnose_fuehrend" na="" xsi:type="string">
                </value>
			</concept> -->	
		</mdat>
	</visit-table>	
	<!-- scripts are run for each complete encounter in the order of occurrence -->
	<script type="text/javascript"><![CDATA[
		if( facts.get("natrium") && facts.get("kalium") ){
			facts.add("nakl").value(1);
		}
		facts.add("cnt").value(facts.size());
	]]>
	</script>
</datasource>
